<!DOCTYPE html>
  
  
  
  
   <html class="no-js"> 

  <head lang="en-us">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,maximum-scale=1">
    <title>Retailer Message Flows - QR Payment Service Interface</title>
    <meta name="generator" content="Hugo 0.29" />

    
    <link rel="canonical" href="https://electrumpayments.github.io/qr-payment-service-interface-docs/retailer-message-flows/">
    

    <meta property="og:url" content="https://electrumpayments.github.io/qr-payment-service-interface-docs/retailer-message-flows/">
    <meta property="og:title" content="QR Payment Service Interface">
    <meta property="og:image" content="https://electrumpayments.github.io/qr-payment-service-interface-docs/images/logo-square.png">
    <meta name="apple-mobile-web-app-title" content="QR Payment Service Interface">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <link rel="shortcut icon" type="image/x-icon" href="https://electrumpayments.github.io/qr-payment-service-interface-docs/images/favicon.ico">
    <link rel="icon" type="image/x-icon" href="https://electrumpayments.github.io/qr-payment-service-interface-docs/images/favicon.ico">

    <style>
      @font-face {
        font-family: 'Icon';
        src: url('https://electrumpayments.github.io/qr-payment-service-interface-docs/fonts/icon.eot?52m981');
        src: url('https://electrumpayments.github.io/qr-payment-service-interface-docs/fonts/icon.eot?#iefix52m981')
               format('embedded-opentype'),
             url('https://electrumpayments.github.io/qr-payment-service-interface-docs/fonts/icon.woff?52m981')
               format('woff'),
             url('https://electrumpayments.github.io/qr-payment-service-interface-docs/fonts/icon.ttf?52m981')
               format('truetype'),
             url('https://electrumpayments.github.io/qr-payment-service-interface-docs/fonts/icon.svg?52m981#icon')
               format('svg');
        font-weight: normal;
        font-style: normal;
      }
    </style>

    <link rel="stylesheet" href="https://electrumpayments.github.io/qr-payment-service-interface-docs/stylesheets/highlight/highlight.css">
    <link rel="stylesheet" href="https://electrumpayments.github.io/qr-payment-service-interface-docs/stylesheets/application.css">
    <link rel="stylesheet" href="https://electrumpayments.github.io/qr-payment-service-interface-docs/stylesheets/palettes.css">

    
    
    
    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Ubuntu:400,700|Ubuntu%2bMono">
    <style>
      body, input {
        font-family: 'Ubuntu', Helvetica, Arial, sans-serif;
      }
      pre, code {
        font-family: 'Ubuntu Mono', 'Courier New', 'Courier', monospace;
      }
    </style>

    
    <script src="https://electrumpayments.github.io/qr-payment-service-interface-docs/javascripts/modernizr.js"></script>

    

  </head>
  <body class="palette-primary-cyan palette-accent-orange">



	
	


<div class="backdrop">
	<div class="backdrop-paper"></div>
</div>

<input class="toggle" type="checkbox" id="toggle-drawer">
<input class="toggle" type="checkbox" id="toggle-search">
<label class="toggle-button overlay" for="toggle-drawer"></label>

<header class="header">
	<nav aria-label="Header">
  <div class="bar default">
    <div class="button button-menu" role="button" aria-label="Menu">
      <label class="toggle-button icon icon-menu" for="toggle-drawer">
        <span></span>
      </label>
    </div>
    <div class="stretch">
      <div class="title">
        QR Payment Service Interface
      </div>
    </div>

    

    
    <div class="button button-github" role="button" aria-label="GitHub">
      <a href="https://github.com/electrumpayments" title="@electrumpayments on GitHub" target="_blank" class="toggle-button icon icon-github"></a>
    </div>
    

    
  </div>
  <div class="bar search">
    <div class="button button-close" role="button" aria-label="Close">
      <label class="toggle-button icon icon-back" for="toggle-search"></label>
    </div>
    <div class="stretch">
      <div class="field">
        <input class="query" type="text" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck>
      </div>
    </div>
    <div class="button button-reset" role="button" aria-label="Search">
      <button class="toggle-button icon icon-close" id="reset-search"></button>
    </div>
  </div>
</nav>

</header>

<main class="main">
	<div class="drawer">
		<nav aria-label="Navigation">
  <a href="https://github.com/electrumpayments/qr-payment-service-interface" class="project">
    <div class="banner">
      
        <div class="logo">
          <img src="https://electrumpayments.github.io/qr-payment-service-interface-docs/images/logo-square.png">
        </div>
      
      <div class="name">
        
          <br>
          electrumpayments/qr-payment-service-interface
        
      </div>
    </div>
  </a>

  <div class="scrollable">
    <div class="wrapper">
      <div class="toc">
        
        <ul>
          




<li>
  
    



<a  title="Getting Started" href="https://electrumpayments.github.io/qr-payment-service-interface-docs/getting-started/">
	
	Getting Started
</a>



  
</li>



<li>
  
    



<a  title="Terminology" href="https://electrumpayments.github.io/qr-payment-service-interface-docs/terminology/">
	
	Terminology
</a>



  
</li>



<li>
  
    



<a  title="Protocol Basics" href="https://electrumpayments.github.io/qr-payment-service-interface-docs/protocol-basics/">
	
	Protocol Basics
</a>



  
</li>



<li>
  
    



<a  title="Partner And Retailer Implementations" href="https://electrumpayments.github.io/qr-payment-service-interface-docs/partner-vs-retailer-implementations/">
	
	Partner And Retailer Implementations
</a>



  
</li>



<li>
  
    



<a  title="Retailer Message Flows" href="https://electrumpayments.github.io/qr-payment-service-interface-docs/retailer-message-flows/">
	
	Retailer Message Flows
</a>



  
</li>



<li>
  
    



<a  title="Partner Message Flows" href="https://electrumpayments.github.io/qr-payment-service-interface-docs/partner-message-flows/">
	
	Partner Message Flows
</a>



  
</li>



<li>
  
    



<a  title="Advanced Topics" href="https://electrumpayments.github.io/qr-payment-service-interface-docs/advanced-topics/">
	
	Advanced Topics
</a>



  
</li>



<li>
  
  <span class="section">Specification</span>
    <ul>
      
        
        



<a  title="Introduction" href="https://electrumpayments.github.io/qr-payment-service-interface-docs/specification/introduction/">
	
	Introduction
</a>



      
        
        



<a  title="Operations" href="https://electrumpayments.github.io/qr-payment-service-interface-docs/specification/operations/">
	
	Operations
</a>



      
        
        



<a  title="Definitions" href="https://electrumpayments.github.io/qr-payment-service-interface-docs/specification/definitions/">
	
	Definitions
</a>



      
        
        



<a  title="Swagger" href="https://electrumpayments.github.io/qr-payment-service-interface-docs/specification/swagger/">
	
	Swagger
</a>



      
        
        



<a  title="Release Notes" href="https://electrumpayments.github.io/qr-payment-service-interface-docs/specification/release-notes/">
	
	Release Notes
</a>



      
    </ul>
  
</li>


        </ul>
        
      </div>
    </div>
  </div>
</nav>

	</div>

	<article class="article">
		<div class="wrapper">
			<h1>Retailer Message Flows </h1>

			

<h2 id="overview">Overview</h2>

<p>From a retailer perspective the QR payment flow comprises of the following operations:</p>

<ol>
<li>Requesting and displaying a QR code</li>
<li>Making a payment authorisation request based on this QR code</li>
<li>Finalising or reversing this payment</li>
</ol>

<p><img src="https://electrumpayments.github.io/qr-payment-service-interface-docs/images/full_qr_flow.png" alt="QR Payment Message Flow" title="QR Payment Flow" /></p>

<h2 id="request-a-qr-code">Request a QR Code</h2>

<p>The message flow to request a QR code works in the following manner:</p>

<ul>
<li>The retailer requests a QR code to be generated using the getQrCode operation.</li>
<li>The QR server returns a QR code containing a unique transaction ID (<code>tranId</code>). For the the structure of this
QR code please see the <a href="https://electrumpayments.github.io/qr-payment-service-interface-docs/advanced-topics/">Advanced Topics</a> section.</li>
<li>The retailer displays the above QR code to the customer allowing the customer to begin the
payment journey by scanning this QR code with their mobile device.</li>
</ul>

<p><img src="https://electrumpayments.github.io/qr-payment-service-interface-docs/images/r2_retailer_get_qr_code_flow.png" alt="Request QR Code Flow" title="Request QR Code Flow" /></p>

<h2 id="request-a-payment">Request a payment</h2>

<p>The payment flow is dual message and comprises two messages:</p>

<ul>
<li>A payment authorisation request (<code>PaymentRequest</code>), which will request the funds to be reserved for tender by the Partner. This
request contains the unique ID encoded in the QR code and will be used to match this <code>PaymentRequest</code> to the QR scan.</li>
<li>One of the following two advice messages, which will be sent &ldquo;offline&rdquo; and subject to store-and-forward (SAF; see <a href="https://electrumpayments.github.io/qr-payment-service-interface-docs/advanced-topics/">Advanced Topics</a>):

<ul>
<li>A finalisation advice (<code>ConfirmationAdvice</code>), which signifies to the Partner that the tender was successful and the funds should be withdrawn.</li>
<li>A reversal (<code>PaymentReversal</code>), which signifies that the tender was not completed and that the reservation on the funds should be removed.</li>
</ul></li>
</ul>

<p><img src="https://electrumpayments.github.io/qr-payment-service-interface-docs/images/r1_retailer_payment_flow.png" alt="Payment Flow" title="Payment Flow" /></p>

<p>It is important to note that the <code>PaymentRequest</code> should always be sent upstream before the QR code has been displayed to the customer for scanning. This is to prevent
creating a window in which it is possible for the customer to scan the QR code before the <code>PaymentRequest</code> is sent. In this case it would not be possible to match the <code>PaymentRequest</code> to the QR scan and hence the tender will fail.</p>

<p>Below is a flow depicting the scenario where a <code>PaymentRequest</code> arrives after the QR code has been scanned.</p>

<p><img src="https://electrumpayments.github.io/qr-payment-service-interface-docs/images/s3_scan_notification_arrives_before_payment_request.png" alt="Scan Precedes Payment Authorisation Flow" title="Payment Flow" /></p>

<h2 id="tender-voids-and-timeout-reversals">Tender Voids and Timeout Reversals</h2>

<p>As mentioned above, a payment authorisation (<code>PaymentRequest</code>) may be reversed or &ldquo;cancelled&rdquo; by a <code>PaymentReversal</code>.
A <code>PaymentReversal</code> should be sent in either of the scenarios below:</p>

<ul>
<li>To void an otherwise successfully processed payment authorisation. This may be required for a number of scenarios, for example the customer has
opted to not continue with the tender, the POS malfunctioned or the basket has been voided by the cashier.</li>
<li>No response to a <code>PaymentRequest</code> was received and the state of the transaction upstream is unknown. In this scenario
a <code>PaymentReversal</code>, as a &ldquo;Timeout Reversal&rdquo;, should be sent to ensure that it is safe to proceed as if the transaction has not gone through.
A <code>PaymentReversal</code> will be subject to SAF, thus it is guaranteed that this transaction will eventually be reversed.</li>
</ul>

<p>In both case above, reversals are intended to correct a system issue or a cancelled transaction, and thus will not be used as a general purpose refund mechanism. Customer refunds and return of goods are out of scope of this document.</p>

<p><img src="https://electrumpayments.github.io/qr-payment-service-interface-docs/images/r3_retailer_timeout_reversal_flow.png" alt="Timeout Reversal Flow" title="Timeout Reversal Flow" /></p>

<p>The full flow for a TimeoutReversal is as per the below diagram.</p>

<p><img src="https://electrumpayments.github.io/qr-payment-service-interface-docs/images/s5_timeout_reversal.png" alt="Timeout Reversal Flow" title="Timeout Reversal Flow" /></p>


			<aside class="copyright" role="note">
				
				&copy; 2021 Released under the Apache 2.0 license
				
			</aside>

			<footer class="footer">
				<nav class="pagination" aria-label="Footer">
  <div >
    <img src="https://electrumpayments.github.io/qr-payment-service-interface-docs/images/logo-small-white.png" align="right"/>
  </div>
</nav>

			</footer>
		</div>
	</article>

	<div class="results" role="status" aria-live="polite">
		<div class="scrollable">
			<div class="wrapper">
				<div class="meta"></div>
				<div class="list"></div>
			</div>
		</div>
	</div>
</main>

    <script>
    
      var base_url = 'https:\/\/electrumpayments.github.io\/qr-payment-service-interface-docs\/';
      var repo_id  = 'electrumpayments\/qr-payment-service-interface';
    
    </script>

    <script src="https://electrumpayments.github.io/qr-payment-service-interface-docs/javascripts/application.js"></script>
    

    <script>
      /* Add headers to scrollspy */
      var headers   = document.getElementsByTagName("h2");
      var scrollspy = document.getElementById('scrollspy');

      if(headers.length > 0) {
        for(var i = 0; i < headers.length; i++) {
          var li = document.createElement("li");
          li.setAttribute("class", "anchor");

          var a  = document.createElement("a");
          a.setAttribute("href", "#" + headers[i].id);
          a.setAttribute("title", headers[i].innerHTML);
          a.innerHTML = headers[i].innerHTML;
          
          li.appendChild(a)
          scrollspy.appendChild(li);
        }
      } else {
        scrollspy.parentElement.removeChild(scrollspy)
      }
      

      /* Add permanent link next to the headers */
      var headers = document.querySelectorAll("h1, h2, h3, h4, h5, h6");

      for(var i = 0; i < headers.length; i++) {
          var a = document.createElement("a");
          a.setAttribute("class", "headerlink");
          a.setAttribute("href", "#" + headers[i].id);
          a.setAttribute("title", "Permanent link")
          a.innerHTML = "#";
          headers[i].appendChild(a);
      }
    </script>

    

    <script src="//gohugo.io/js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
  </body>
</html>
